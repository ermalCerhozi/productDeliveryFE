<ng-container *transloco="let t">
    <div class="page-container">
        <form [formGroup]="setPasswordForm" (ngSubmit)="onSubmit()" class="set-password-form">
            <h2 class="title">{{ t('setPassword.title') }}</h2>
            <p class="subtitle">{{ t('setPassword.subtitle') }}</p>

            <!-- Password Field -->
            <div class="input-field" [ngClass]="{'error-border': password?.invalid && password?.touched}">
                <i class="fas fa-lock"></i>
                <input [type]="hidePassword ? 'password' : 'text'" formControlName="password"
                    [placeholder]="t('setPassword.passwordPlaceholder')" />
                <i [class]="hidePassword ? 'fas fa-eye' : 'fas fa-eye-slash'" class="toggle-password"
                    (click)="togglePasswordVisibility('password')"></i>
            </div>

            @if (password?.hasError('required') && password?.touched) {
            <div class="error-text">
                {{ t('setPassword.passwordRequired') }}
            </div>
            }
            @if (password?.hasError('minlength') && password?.touched) {
            <div class="error-text">
                {{ t('setPassword.passwordMinLength') }}
            </div>
            }

            <!-- Confirm Password Field -->
            <div class="input-field" [ngClass]="{'error-border': confirmPassword?.invalid && confirmPassword?.touched}">
                <i class="fas fa-lock"></i>
                <input [type]="hideConfirmPassword ? 'password' : 'text'" formControlName="confirmPassword"
                    [placeholder]="t('setPassword.confirmPasswordPlaceholder')" />
                <i [class]="hideConfirmPassword ? 'fas fa-eye' : 'fas fa-eye-slash'" class="toggle-password"
                    (click)="togglePasswordVisibility('confirmPassword')"></i>
            </div>

            @if (confirmPassword?.hasError('required') && confirmPassword?.touched) {
            <div class="error-text">
                {{ t('setPassword.confirmPasswordRequired') }}
            </div>
            }
            @if (confirmPassword?.hasError('passwordMismatch') && confirmPassword?.touched) {
            <div class="error-text">
                {{ t('setPassword.passwordMismatch') }}
            </div>
            }

            <!-- Password Requirements -->
            <div class="password-requirements">
                <p class="requirements-title">{{ t('setPassword.requirementsTitle') }}</p>
                <ul>
                    <li [ngClass]="{'valid': (password?.value?.length ?? 0) >= 8}">
                        <i [class]="(password?.value?.length ?? 0) >= 8 ? 'fas fa-check' : 'fas fa-times'"></i>
                        {{ t('setPassword.requirement1') }}
                    </li>
                    <li [ngClass]="{'valid': !confirmPassword?.hasError('passwordMismatch') && confirmPassword?.value}">
                        <i
                            [class]="!confirmPassword?.hasError('passwordMismatch') && confirmPassword?.value ? 'fas fa-check' : 'fas fa-times'"></i>
                        {{ t('setPassword.requirement2') }}
                    </li>
                </ul>
            </div>

            <!-- Submit Button -->
            <button type="submit" [disabled]="setPasswordForm.invalid || isLoading || !token" class="btn">
                @if (isLoading) {
                <i class="fas fa-spinner fa-spin"></i>
                {{ t('setPassword.submitting') }}
                } @else {
                {{ t('setPassword.submitButton') }}
                }
            </button>

            <!-- Back to Login Link -->
            <a routerLink="/login" class="back-to-login">
                <i class="fas fa-arrow-left"></i>
                {{ t('setPassword.backToLogin') }}
            </a>
        </form>
    </div>
</ng-container>
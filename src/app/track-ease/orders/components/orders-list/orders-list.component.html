<ng-container *transloco="let t">
    <div class="header">
        <div class="controls-row">
            <button class="add-order" mat-raised-button color="primary" (click)="createOrder()">
                <mat-icon>add</mat-icon>
                <span> {{ t('ordersList.createOrder') }} </span>
            </button>
            <button
                mat-stroked-button
                [matMenuTriggerFor]="downloadMenu"
                class="download-pdf"
                [disabled]="filterResults().length === 0"
            >
                <mat-icon fontSet="material-icons-outlined">download</mat-icon>
                <span>{{ t('ordersList.download') }}</span>
            </button>

            <mat-menu #downloadMenu="matMenu">
                <button mat-menu-item (click)="downloadOrdersPdf()">
                    <mat-icon fontSet="material-icons-outlined">picture_as_pdf</mat-icon>
                    <span>{{ t('ordersList.pdf') }}</span>
                </button>
                <button mat-menu-item (click)="downloadOrdersCsv()">
                    <mat-icon fontSet="material-icons-outlined">table_chart</mat-icon>
                    <span>{{ t('ordersList.csv') }}</span>
                </button>
            </mat-menu>
        </div>

        <div class="filters-row">
            <app-filters>
                <!-- The datepicker -->
                <!-- <mat-form-field>
        <mat-label>Enter a date range</mat-label>
        <mat-date-range-input [formGroup]="range" [rangePicker]="picker">
          <input matStartDate formControlName="startDate" placeholder="Start date" />
          <input matEndDate formControlName="endDate" placeholder="End date" />
        </mat-date-range-input>
        <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
        <mat-date-range-picker #picker></mat-date-range-picker>

        @if (range.controls.startDate.hasError('matStartDateInvalid')) {
          <mat-error>Invalid start date</mat-error>
        }
        @if (range.controls.endDate.hasError('matEndDateInvalid')) {
          <mat-error>Invalid end date</mat-error>
        }
      </mat-form-field> -->

                <app-simple-radio-select-filter
                    [labelTK]="t('ordersList.date')"
                    [fields]="orderDates()"
                    [defaultEmptyValue]="defaultDateFilter"
                    [selection]="selectedDate()"
                    [customLabelWidth]="'105px'"
                    [panelClass]="'date-filter-panel'"
                    (selectionChange)="applyFilters($event, 'date')"
                ></app-simple-radio-select-filter>

                <app-advanced-text-filter
                    [labelTK]="t('ordersList.client')"
                    [loadingPage]="clientsLoading()"
                    [hasMoreItems]="hasMoreClientsToLoad()"
                    [selection]="selectedClients()"
                    [fields]="clients()"
                    [searchForTK]="'ordersList.orderClientSearch'"
                    [noResultsTK]="'ordersList.orderClientsNoResults'"
                    [panelClass]="'client-categories-filter-panel'"
                    [customLabelWidth]="'110px'"
                    (searchChange)="clientSearchChange($event)"
                    (loadMore)="loadMoreClients()"
                    (selectionChange)="applyFilters($event, 'client')"
                    (openedChange)="onClientDropdownOpened($event)"
                >
                </app-advanced-text-filter>

                <app-advanced-text-filter
                    [labelTK]="t('ordersList.seller')"
                    [loadingPage]="sellersLoading()"
                    [hasMoreItems]="hasMoreSellersToLoad()"
                    [selection]="selectedSellers()"
                    [fields]="sellers()"
                    [searchForTK]="'ordersList.orderSellerSearch'"
                    [noResultsTK]="'ordersList.orderSellerNoResults'"
                    [panelClass]="'seller-categories-filter-panel'"
                    [customLabelWidth]="'110px'"
                    (searchChange)="sellerSearchChange($event)"
                    (loadMore)="loadMoreSellers()"
                    (selectionChange)="applyFilters($event, 'seller')"
                    (openedChange)="onSellerDropdownOpened($event)"
                >
                </app-advanced-text-filter>
            </app-filters>
        </div>
    </div>

    <mat-divider></mat-divider>

    @if (filterResults().length > 0) {
        <app-filters-result
            class="filter-results"
            [labelTK]="t('ordersList.clearFilters')"
            [results]="filterResults()"
            (clearResults)="clearFilters()"
            (removeFilter)="removeFilter($event)"
        >
        </app-filters-result>
    }

    <div class="results-summary">{{ totalCount() }} Results</div>

    <app-table
        [data]="(tableData$ | async) || []"
        [columns]="tableColumns()"
        [searchQuery]="''"
        [isSelectable]="false"
        [totalCount]="totalCount()"
        (onEdit)="onEdit($event)"
        (onDelete)="onDelete($event)"
        (currentPageInfo)="onPageInfoChange($event)">
    </app-table>
</ng-container>

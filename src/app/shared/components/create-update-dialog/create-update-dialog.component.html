<ng-container *transloco="let t">
    <div class="dialog-container">
        <div mat-dialog-title>
            @switch (type()) {
                @case ('product') {
                    {{ action() === 'create' ? t('createUpdateDialog.create') : t('createUpdateDialog.update') }} {{ t('createUpdateDialog.product') }}
                }
                @case ('user') {
                    {{ action() === 'create' ? t('createUpdateDialog.create') : t('createUpdateDialog.update') }} {{ t('createUpdateDialog.user') }}
                }
            }
        </div>

    <mat-dialog-content class="dialog-content">
        <form [formGroup]="form" (ngSubmit)="insertItem()" class="dialog-content-form">
            @switch (type()) {
                <!-- User Form Fields -->
                @case ('user') {
                    <mat-form-field>
                        <mat-label>{{ t('createUpdateDialog.firstName') }}</mat-label>
                        <input matInput formControlName="first_name" required [title]="t('createUpdateDialog.firstName')" />
                        @if (form.get('first_name')?.invalid && form.get('first_name')?.touched) {
                            <mat-error> {{ t('createUpdateDialog.firstNameRequired') }} </mat-error>
                        }
                    </mat-form-field>
                    <mat-form-field>
                        <mat-label>{{ t('createUpdateDialog.lastName') }}</mat-label>
                        <input
                            matInput
                            type="text"
                            formControlName="last_name"
                            required
                            [title]="t('createUpdateDialog.lastName')"
                        />
                        @if (form.get('last_name')?.invalid && form.get('last_name')?.touched) {
                            <mat-error> {{ t('createUpdateDialog.lastNameRequired') }} </mat-error>
                        }
                    </mat-form-field>
                    <mat-form-field>
                        <mat-label>{{ t('createUpdateDialog.nickname') }}</mat-label>
                        <input matInput type="text" formControlName="nickname" [title]="t('createUpdateDialog.nickname')" />
                        @if (form.get('nickname')?.invalid && form.get('nickname')?.touched) {
                            <mat-error> {{ t('createUpdateDialog.nicknameRequired') }} </mat-error>
                        }
                    </mat-form-field>
                    <mat-form-field>
                        <mat-label>{{ t('createUpdateDialog.email') }}</mat-label>
                        <input matInput type="email" formControlName="email" [title]="t('createUpdateDialog.email')" />
                        @if (form.get('email')?.invalid && form.get('email')?.touched) {
                            <mat-error> {{ t('createUpdateDialog.emailRequired') }} </mat-error>
                        }
                    </mat-form-field>
                    <mat-form-field>
                        <mat-label>{{ t('createUpdateDialog.phoneNumber') }}</mat-label>
                        <div style="display: flex; align-items: center">
                            <mat-select
                                formControlName="phone_prefix"
                                style="width: 110px; margin-right: 8px"
                                required
                            >
                                <mat-option value="+355">ðŸ‡¦ðŸ‡± +355 (AL)</mat-option>
                                <mat-option value="+39">ðŸ‡®ðŸ‡¹ +39 (IT)</mat-option>
                                <mat-option value="+49">ðŸ‡©ðŸ‡ª +49 (DE)</mat-option>
                                <mat-option value="+33">ðŸ‡«ðŸ‡· +33 (FR)</mat-option>
                                <mat-option value="+34">ðŸ‡ªðŸ‡¸ +34 (ES)</mat-option>
                                <mat-option value="+44">ðŸ‡¬ðŸ‡§ +44 (UK)</mat-option>
                            </mat-select>
                            <input
                                matInput
                                type="tel"
                                formControlName="phone_number"
                                required
                                [title]="t('createUpdateDialog.phoneNumber')"
                                pattern="[0-9]{7,12}"
                                maxlength="12"
                                [placeholder]="t('createUpdateDialog.phoneNumberPlaceholder')"
                                (click)="$event.stopPropagation()"
                            />
                        </div>
                        @if (
                            form.get('phone_number')?.invalid && form.get('phone_number')?.touched
                        ) {
                            <mat-error>
                                @if (form.get('phone_number')?.errors?.['required']) {
                                    {{ t('createUpdateDialog.phoneNumberRequired') }}
                                }
                                @if (form.get('phone_number')?.errors?.['pattern']) {
                                    {{ t('createUpdateDialog.phoneNumberPattern') }}
                                }
                            </mat-error>
                        }
                    </mat-form-field>
                    <mat-form-field>
                        <mat-label>{{ t('createUpdateDialog.role') }}</mat-label>
                        <mat-select formControlName="role" required>
                            <mat-option value="client">{{ t('createUpdateDialog.roleClient') }}</mat-option>
                            <mat-option value="admin">{{ t('createUpdateDialog.roleAdmin') }}</mat-option>
                            <mat-option value="seller">{{ t('createUpdateDialog.roleSeller') }}</mat-option>
                        </mat-select>
                        @if (form.get('role')?.invalid && form.get('role')?.touched) {
                            <mat-error> {{ t('createUpdateDialog.roleRequired') }} </mat-error>
                        }
                    </mat-form-field>
                    <mat-form-field>
                        <mat-label>{{ t('createUpdateDialog.location') }}</mat-label>
                        <input matInput type="text" formControlName="location" [title]="t('createUpdateDialog.location')" />
                        <button
                            mat-icon-button
                            matSuffix
                            (click)="openInNewWindow(form.get('location')?.value)"
                            type="button"
                        >
                            <mat-icon>open_in_new</mat-icon>
                        </button>
                    </mat-form-field>
                }
                <!-- Product Form Fields -->
                @case ('product') {
                    <mat-form-field>
                        <mat-label>{{ t('createUpdateDialog.productName') }}</mat-label>
                        <input
                            matInput
                            formControlName="product_name"
                            required
                            [title]="t('createUpdateDialog.productName')"
                        />
                        @if (
                            form.get('product_name')?.invalid && form.get('product_name')?.touched
                        ) {
                            <mat-error> {{ t('createUpdateDialog.productNameRequired') }} </mat-error>
                        }
                    </mat-form-field>
                    <mat-form-field>
                        <mat-label>{{ t('createUpdateDialog.price') }}</mat-label>
                        <input
                            matInput
                            type="number"
                            min="0"
                            formControlName="price"
                            required
                            [title]="t('createUpdateDialog.price')"
                        />
                        @if (form.get('price')?.invalid && form.get('price')?.touched) {
                            <mat-error> {{ t('createUpdateDialog.priceRequired') }} </mat-error>
                        }
                    </mat-form-field>
                    <mat-form-field>
                        <mat-label>{{ t('createUpdateDialog.imageUrl') }}</mat-label>
                        <input matInput formControlName="image" [title]="t('createUpdateDialog.imageUrl')" />
                    </mat-form-field>
                    <mat-form-field>
                        <mat-label>{{ t('createUpdateDialog.description') }}</mat-label>
                        <textarea
                            matInput
                            formControlName="description"
                            [title]="t('createUpdateDialog.description')"
                        ></textarea>
                    </mat-form-field>
                    <mat-form-field>
                        <mat-label>{{ t('createUpdateDialog.ingredients') }}</mat-label>
                        <textarea
                            matInput
                            formControlName="ingredients"
                            [title]="t('createUpdateDialog.ingredients')"
                        ></textarea>
                    </mat-form-field>
                }
            }
        </form>
    </mat-dialog-content>

    <mat-dialog-actions align="end">
        <button class="button cancel" mat-stroked-button color="warn" mat-dialog-close>
            {{ t('createUpdateDialog.cancel') }}
        </button>
        <button
            class="button"
            mat-stroked-button
            color="primary"
            type="submit"
            [disabled]="form.invalid || !formHasChanged()"
            autofocus
            (click)="insertItem()"
        >
            {{ action() }}
        </button>
    </mat-dialog-actions>
</div>
</ng-container>
